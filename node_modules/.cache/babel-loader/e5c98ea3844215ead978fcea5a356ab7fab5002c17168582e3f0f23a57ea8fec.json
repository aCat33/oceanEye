{"ast":null,"code":"// 标记图层辅助函数 - 用于天地图\nexport const renderMarkersForTianditu = (map, T, layer, allItems, highlightedItemId, playbackState, setHighlightedItemId, setSelectedCluster) => {\n  // 清除旧图层\n  layer.forEach(overlay => map.removeOverLay(overlay));\n  layer.length = 0;\n\n  // 简单聚合逻辑（基于经纬度距离）\n  const clusters = [];\n  const processedIds = new Set();\n  for (let i = 0; i < allItems.length; i++) {\n    if (processedIds.has(allItems[i].id)) continue;\n    const base = allItems[i];\n    const cluster = [base];\n    processedIds.add(base.id);\n    for (let j = i + 1; j < allItems.length; j++) {\n      if (processedIds.has(allItems[j].id)) continue;\n      const distance = Math.sqrt(Math.pow((base.lat - allItems[j].lat) * 111, 2) + Math.pow((base.lon - allItems[j].lon) * 111 * Math.cos(base.lat * Math.PI / 180), 2));\n      if (distance < 50) {\n        // 50km聚合\n        cluster.push(allItems[j]);\n        processedIds.add(allItems[j].id);\n      }\n    }\n    clusters.push(cluster);\n  }\n  clusters.forEach(clusterItems => {\n    const isCluster = clusterItems.length > 1;\n    const mainItem = clusterItems[0];\n    const position = new T.LngLat(mainItem.lon, mainItem.lat);\n    const isHighlighted = !isCluster && mainItem.id === highlightedItemId;\n    const hasAlarmInCluster = clusterItems.some(i => i.isAlarm);\n    if (playbackState.id === mainItem.id && playbackState.playing) return;\n    let html = '';\n    if (isCluster) {\n      const colorClass = hasAlarmInCluster ? 'bg-red-600 border-red-400' : clusterItems.some(i => i.type === 'rig') ? 'bg-orange-600 border-orange-400' : 'bg-blue-600 border-blue-400';\n      html = `<div class=\"flex items-center justify-center w-6 h-6 rounded-full border-2 text-white font-bold shadow-lg ${colorClass}\">${clusterItems.length}</div>`;\n    } else {\n      const item = mainItem;\n      const rotation = item.course || 0;\n      const bgClass = item.isAlarm ? 'bg-red-600' : item.type === 'rig' ? 'bg-orange-500' : 'bg-blue-500';\n      if (item.type === 'rig') {\n        html = `<div class=\"w-6 h-6 flex items-center justify-center ${bgClass} rounded text-white shadow-md border border-white\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z\"></path></svg></div>`;\n      } else {\n        html = `<div class=\"w-6 h-6 flex items-center justify-center ${bgClass} rounded-full text-white shadow-md border border-white\" style=\"transform: rotate(${rotation}deg)\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><polygon points=\"12 2 22 22 12 18 2 22\"></polygon></svg></div>`;\n      }\n      if (item.isAlarm) {\n        html = `<div class=\"relative w-full h-full\"><div class=\"absolute inset-[-8px] bg-red-500 rounded-full animate-ping opacity-75\"></div><div class=\"absolute inset-[-4px] bg-red-500 rounded-full opacity-40\"></div><div class=\"relative w-full h-full\">${html}</div></div>`;\n      } else if (isHighlighted) {\n        html = `<div class=\"relative w-full h-full\"><div class=\"absolute inset-[-8px] bg-yellow-400 rounded-full animate-ping opacity-75\"></div><div class=\"absolute inset-[-4px] bg-yellow-400 rounded-full opacity-40\"></div><div class=\"relative w-full h-full\">${html}</div></div>`;\n      }\n    }\n    const icon = new T.Icon({\n      iconUrl: \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"48\" height=\"48\"><foreignObject width=\"48\" height=\"48\">${html}</foreignObject></svg>`),\n      iconSize: new T.Point(48, 48),\n      iconAnchor: new T.Point(24, 24)\n    });\n    const marker = new T.Marker(position, {\n      icon\n    });\n    marker.addEventListener('click', () => {\n      if (!isCluster) setHighlightedItemId(mainItem.id);\n      setSelectedCluster({\n        id: isCluster ? `cluster-${mainItem.id}` : mainItem.id,\n        isCluster,\n        items: clusterItems\n      });\n    });\n    map.addOverLay(marker);\n    layer.push(marker);\n  });\n};","map":{"version":3,"names":["renderMarkersForTianditu","map","T","layer","allItems","highlightedItemId","playbackState","setHighlightedItemId","setSelectedCluster","forEach","overlay","removeOverLay","length","clusters","processedIds","Set","i","has","id","base","cluster","add","j","distance","Math","sqrt","pow","lat","lon","cos","PI","push","clusterItems","isCluster","mainItem","position","LngLat","isHighlighted","hasAlarmInCluster","some","isAlarm","playing","html","colorClass","type","item","rotation","course","bgClass","icon","Icon","iconUrl","encodeURIComponent","iconSize","Point","iconAnchor","marker","Marker","addEventListener","items","addOverLay"],"sources":["C:/Users/10211/Desktop/AI Files/oceanEye/src/utils/markerUtils.js"],"sourcesContent":["// 标记图层辅助函数 - 用于天地图\r\nexport const renderMarkersForTianditu = (map, T, layer, allItems, highlightedItemId, playbackState, setHighlightedItemId, setSelectedCluster) => {\r\n  // 清除旧图层\r\n  layer.forEach(overlay => map.removeOverLay(overlay));\r\n  layer.length = 0;\r\n\r\n  // 简单聚合逻辑（基于经纬度距离）\r\n  const clusters = [];\r\n  const processedIds = new Set();\r\n  \r\n  for (let i = 0; i < allItems.length; i++) {\r\n    if (processedIds.has(allItems[i].id)) continue;\r\n    const base = allItems[i];\r\n    const cluster = [base];\r\n    processedIds.add(base.id);\r\n    \r\n    for (let j = i + 1; j < allItems.length; j++) {\r\n      if (processedIds.has(allItems[j].id)) continue;\r\n      const distance = Math.sqrt(\r\n        Math.pow((base.lat - allItems[j].lat) * 111, 2) + \r\n        Math.pow((base.lon - allItems[j].lon) * 111 * Math.cos(base.lat * Math.PI / 180), 2)\r\n      );\r\n      if (distance < 50) { // 50km聚合\r\n        cluster.push(allItems[j]);\r\n        processedIds.add(allItems[j].id);\r\n      }\r\n    }\r\n    clusters.push(cluster);\r\n  }\r\n\r\n  clusters.forEach(clusterItems => {\r\n    const isCluster = clusterItems.length > 1;\r\n    const mainItem = clusterItems[0];\r\n    const position = new T.LngLat(mainItem.lon, mainItem.lat);\r\n    const isHighlighted = !isCluster && mainItem.id === highlightedItemId;\r\n    const hasAlarmInCluster = clusterItems.some(i => i.isAlarm);\r\n    \r\n    if (playbackState.id === mainItem.id && playbackState.playing) return;\r\n\r\n    let html = '';\r\n\r\n    if (isCluster) {\r\n      const colorClass = hasAlarmInCluster ? 'bg-red-600 border-red-400' : \r\n        (clusterItems.some(i=>i.type==='rig') ? 'bg-orange-600 border-orange-400' : 'bg-blue-600 border-blue-400');\r\n      html = `<div class=\"flex items-center justify-center w-6 h-6 rounded-full border-2 text-white font-bold shadow-lg ${colorClass}\">${clusterItems.length}</div>`;\r\n    } else {\r\n      const item = mainItem;\r\n      const rotation = item.course || 0;\r\n      const bgClass = item.isAlarm ? 'bg-red-600' : (item.type === 'rig' ? 'bg-orange-500' : 'bg-blue-500');\r\n      \r\n      if (item.type === 'rig') {\r\n        html = `<div class=\"w-6 h-6 flex items-center justify-center ${bgClass} rounded text-white shadow-md border border-white\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z\"></path></svg></div>`;\r\n      } else {\r\n        html = `<div class=\"w-6 h-6 flex items-center justify-center ${bgClass} rounded-full text-white shadow-md border border-white\" style=\"transform: rotate(${rotation}deg)\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><polygon points=\"12 2 22 22 12 18 2 22\"></polygon></svg></div>`;\r\n      }\r\n\r\n      if (item.isAlarm) {\r\n        html = `<div class=\"relative w-full h-full\"><div class=\"absolute inset-[-8px] bg-red-500 rounded-full animate-ping opacity-75\"></div><div class=\"absolute inset-[-4px] bg-red-500 rounded-full opacity-40\"></div><div class=\"relative w-full h-full\">${html}</div></div>`;\r\n      } else if (isHighlighted) {\r\n        html = `<div class=\"relative w-full h-full\"><div class=\"absolute inset-[-8px] bg-yellow-400 rounded-full animate-ping opacity-75\"></div><div class=\"absolute inset-[-4px] bg-yellow-400 rounded-full opacity-40\"></div><div class=\"relative w-full h-full\">${html}</div></div>`;\r\n      }\r\n    }\r\n\r\n    const icon = new T.Icon({\r\n      iconUrl: \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"48\" height=\"48\"><foreignObject width=\"48\" height=\"48\">${html}</foreignObject></svg>`),\r\n      iconSize: new T.Point(48, 48),\r\n      iconAnchor: new T.Point(24, 24)\r\n    });\r\n\r\n    const marker = new T.Marker(position, { icon });\r\n    \r\n    marker.addEventListener('click', () => {\r\n      if (!isCluster) setHighlightedItemId(mainItem.id);\r\n      setSelectedCluster({ \r\n        id: isCluster ? `cluster-${mainItem.id}` : mainItem.id, \r\n        isCluster, \r\n        items: clusterItems \r\n      });\r\n    });\r\n\r\n    map.addOverLay(marker);\r\n    layer.push(marker);\r\n  });\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}